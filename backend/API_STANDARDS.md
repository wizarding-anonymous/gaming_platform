# Стандарты API, форматов данных и событий

## Стандарты REST API

### Общие принципы

1. **Версионирование**
   - Версия API должна быть указана в URL: `/api/v1/resource`
   - Мажорная версия (v1, v2) меняется при несовместимых изменениях
   - Минорные изменения (добавление новых полей) не требуют изменения версии

2. **Формат URL**
   - Использовать существительные во множественном числе для ресурсов: `/api/v1/games`, `/api/v1/users`
   - Использовать вложенные ресурсы для выражения отношений: `/api/v1/games/{game_id}/reviews`
   - Использовать kebab-case для составных слов: `/api/v1/payment-methods`
   - Не использовать глаголы в URL (кроме специальных действий)

3. **HTTP-методы**
   - GET: получение ресурса или коллекции ресурсов
   - POST: создание нового ресурса
   - PUT: полное обновление существующего ресурса
   - PATCH: частичное обновление существующего ресурса
   - DELETE: удаление ресурса

4. **Коды состояния HTTP**
   - 200 OK: успешный запрос
   - 201 Created: успешное создание ресурса
   - 204 No Content: успешный запрос без тела ответа
   - 400 Bad Request: ошибка в запросе клиента
   - 401 Unauthorized: отсутствие аутентификации
   - 403 Forbidden: недостаточно прав доступа
   - 404 Not Found: ресурс не найден
   - 409 Conflict: конфликт при обновлении ресурса
   - 422 Unprocessable Entity: ошибка валидации
   - 429 Too Many Requests: превышение лимита запросов
   - 500 Internal Server Error: внутренняя ошибка сервера

5. **Пагинация**
   - Использовать параметры `page` и `per_page` для пагинации
   - Возвращать метаданные о пагинации в ответе: `total`, `page`, `per_page`, `pages`
   - Включать ссылки на предыдущую и следующую страницы в заголовке `Link`

6. **Фильтрация**
   - Использовать параметры запроса для фильтрации: `?status=active&category=rpg`
   - Поддерживать операторы сравнения: `?price_gte=100&price_lte=200`
   - Поддерживать поиск по тексту: `?search=keyword`

7. **Сортировка**
   - Использовать параметр `sort` для сортировки: `?sort=name`
   - Указывать направление сортировки: `?sort=-price` (по убыванию)
   - Поддерживать сортировку по нескольким полям: `?sort=category,-price`

## Стандарты gRPC API

1. **Структура проекта**
   - Хранить proto-файлы в директории `api/proto`
   - Использовать подкаталоги для разных доменных областей
   - Генерировать код в директории `api/gen`

2. **Именование**
   - Использовать CamelCase для сервисов, методов и сообщений
   - Использовать snake_case для полей сообщений
   - Добавлять суффикс `Service` к названиям сервисов
   - Добавлять суффиксы `Request` и `Response` к названиям сообщений запросов и ответов

3. **Версионирование**
   - Указывать версию в имени пакета: `package auth.v1;`
   - Использовать семантическое версионирование
   - Не изменять существующие поля, только добавлять новые

4. **Документация**
   - Документировать все сервисы, методы и поля
   - Указывать примеры использования
   - Описывать возможные ошибки

## Форматы данных

1. **JSON**
   - Использовать camelCase для имен полей
   - Использовать ISO 8601 для дат и времени: `YYYY-MM-DDTHH:mm:ss.sssZ`
   - Использовать UTF-8 для кодирования
   - Включать поле `error` с описанием ошибки в случае неуспешного запроса

2. **Protocol Buffers**
   - Использовать для gRPC API
   - Использовать для сериализации данных в Kafka
   - Определять все сообщения в proto-файлах

## Стандарты событий

1. **Именование событий**
   - Использовать прошедшее время: `UserRegistered`, `GamePurchased`
   - Использовать CamelCase
   - Указывать домен в имени события: `Auth.UserRegistered`, `Catalog.GameAdded`

2. **Структура события**
   - Включать метаданные: `id`, `type`, `timestamp`, `version`
   - Включать данные события в поле `payload`
   - Включать информацию об источнике события: `source_service`, `source_instance`

3. **Обработка событий**
   - Обеспечивать идемпотентность обработчиков событий
   - Реализовывать механизм повторных попыток для неудачных обработок
   - Логировать все этапы обработки события

## Стандарты конфигурационных файлов

1. **Формат конфигурации**
   - Использовать YAML для конфигурационных файлов
   - Хранить конфигурации в директории `configs`
   - Использовать разные файлы для разных окружений: `config.dev.yaml`, `config.prod.yaml`

2. **Структура конфигурации**
   - Группировать настройки по компонентам: `database`, `http`, `grpc`, `kafka`
   - Использовать вложенные структуры для сложных настроек
   - Документировать все параметры конфигурации

3. **Переменные окружения**
   - Поддерживать переопределение настроек через переменные окружения
   - Использовать префикс с именем сервиса для переменных окружения: `AUTH_DB_HOST`
   - Документировать все поддерживаемые переменные окружения
