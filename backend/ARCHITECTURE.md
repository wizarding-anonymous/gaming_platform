# Архитектура проекта

## Обзор

Проект представляет собой российский аналог платформы Steam, разработанный с использованием микросервисной архитектуры. Система состоит из независимых микросервисов, каждый из которых отвечает за определенную функциональность.

## Микросервисы

### Auth Service

Сервис аутентификации и авторизации отвечает за:
- Регистрацию и аутентификацию пользователей
- Управление сессиями
- Выдачу и проверку JWT токенов
- Двухфакторную аутентификацию
- Управление ролями и разрешениями
- Интеграцию с внешними провайдерами аутентификации (включая Telegram)

### Account Service

Сервис управления аккаунтами отвечает за:
- Управление профилями пользователей
- Настройки аккаунта
- Историю активности
- Управление друзьями и социальными связями
- Верификацию пользователей (email, телефон)

### Catalog Service

Сервис управления каталогом отвечает за:
- Хранение и управление метаданными игр
- Категоризацию и теги
- Поиск и фильтрацию игр
- Управление ценами и скидками
- Региональные ограничения

### Library Service

Сервис управления библиотекой отвечает за:
- Управление библиотекой игр пользователя
- Отслеживание времени игры
- Управление достижениями
- Синхронизацию сохранений
- Статистику использования

### Download Service

Сервис загрузки отвечает за:
- Управление загрузками игр и контента
- Проверку целостности файлов
- Дельта-обновления
- Управление очередью загрузок
- Возобновление прерванных загрузок

### Payment Service

Сервис платежей отвечает за:
- Обработку платежей
- Управление кошельком пользователя
- Историю транзакций
- Интеграцию с платежными системами
- Возвраты и компенсации

### Social Service

Сервис социальных взаимодействий отвечает за:
- Управление друзьями и группами
- Чаты и сообщения
- Активность друзей
- Приглашения и совместную игру

### Developer Service

Сервис для разработчиков отвечает за:
- Управление аккаунтами разработчиков
- Публикацию и обновление игр
- Аналитику для разработчиков
- Управление DLC и дополнительным контентом

### Admin Service

Сервис администрирования отвечает за:
- Управление пользователями и модерацию
- Управление контентом
- Мониторинг системы
- Управление правами доступа

### Analytics Service

Сервис аналитики отвечает за:
- Сбор и анализ метрик
- Генерацию отчетов
- Персонализированные рекомендации
- A/B тестирование

### Notification Service

Сервис уведомлений отвечает за:
- Отправку уведомлений пользователям
- Управление подписками на уведомления
- Шаблоны уведомлений
- Интеграцию с внешними каналами уведомлений

### API Gateway

API Gateway отвечает за:
- Маршрутизацию запросов к соответствующим микросервисам
- Аутентификацию и авторизацию запросов
- Ограничение частоты запросов
- Кэширование ответов
- Агрегацию данных из нескольких микросервисов

## Коммуникация между сервисами

Микросервисы взаимодействуют друг с другом через:
1. **REST API** - для синхронных запросов
2. **gRPC** - для эффективной синхронной коммуникации
3. **Kafka/NATS** - для асинхронной коммуникации и событийно-ориентированной архитектуры

## Хранение данных

Каждый микросервис имеет собственную базу данных PostgreSQL, что обеспечивает изоляцию данных и независимость сервисов.

## Кэширование

Redis используется для:
- Кэширования данных
- Хранения сессий
- Ограничения частоты запросов (rate limiting)
- Распределенных блокировок

## Развертывание

Проект поддерживает развертывание через:
- Docker и Docker Compose для разработки и тестирования
- Kubernetes для продакшен-окружения

## Мониторинг и логирование

Система включает в себя:
- Сбор метрик с помощью Prometheus
- Визуализацию метрик с помощью Grafana
- Трассировку запросов с помощью OpenTelemetry
- Централизованное логирование с использованием Elasticsearch

## Клиентские приложения

Платформа предоставляет следующие клиентские приложения:
- Десктопный клиент (Windows, macOS, Linux) на Flutter
- Мобильный клиент (Android, iOS) на Flutter
- Веб-клиент на Flutter Web

## Схема архитектуры

```
┌───────────────┐
│               │
│  API Gateway  │
│               │
└───────┬───────┘
        │
        ▼
┌───────────────────────────────────────────────────────────────────┐
│                                                                   │
│                         Микросервисы                              │
│                                                                   │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  │
│  │         │  │         │  │         │  │         │  │         │  │
│  │  Auth   │  │ Account │  │ Catalog │  │ Library │  │ Payment │  │
│  │         │  │         │  │         │  │         │  │         │  │
│  └─────────┘  └─────────┘  └─────────┘  └─────────┘  └─────────┘  │
│                                                                   │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  │
│  │         │  │         │  │         │  │         │  │         │  │
│  │ Download│  │ Social  │  │Developer│  │  Admin  │  │Analytics│  │
│  │         │  │         │  │         │  │         │  │         │  │
│  └─────────┘  └─────────┘  └─────────┘  └─────────┘  └─────────┘  │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘
        │
        ▼
┌───────────────────────────────────────────────────────────────────┐
│                                                                   │
│                      Инфраструктура                               │
│                                                                   │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐  │
│  │         │  │         │  │         │  │         │  │         │  │
│  │PostgreSQL│  │  Redis  │  │ Kafka/  │  │Prometheus│  │Elastic-│  │
│  │         │  │         │  │  NATS   │  │ Grafana │  │ search  │  │
│  └─────────┘  └─────────┘  └─────────┘  └─────────┘  └─────────┘  │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘
        │
        ▼
┌───────────────────────────────────────────────────────────────────┐
│                                                                   │
│                     Клиентские приложения                         │
│                                                                   │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐               │
│  │             │  │             │  │             │               │
│  │  Десктоп    │  │  Мобильный  │  │     Веб     │               │
│  │  (Flutter)  │  │  (Flutter)  │  │  (Flutter)  │               │
│  │             │  │             │  │             │               │
│  └─────────────┘  └─────────────┘  └─────────────┘               │
│                                                                   │
└───────────────────────────────────────────────────────────────────┘
```

## Расширение архитектуры

Архитектура спроектирована для легкого добавления новых микросервисов и компонентов. Все микросервисы следуют единым стандартам API, форматов данных, событий и конфигурационных файлов, что обеспечивает их совместимость и упрощает интеграцию.
